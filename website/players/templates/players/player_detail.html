{% extends "players/player_base.html" %}
{% load i18n %}

{% block title %}Player {{ object.username }}{% endblock %}
{% block content %}

  <div class="row">
    <div class="col-md-12">
      <h1>{{ object.username }}</h1>
      <h2>Laptimes</h2>
      <table id="playerlaptimetable" class="table table-striped table-bordered table-condensed">
        <thead>
        <th>{% trans "Track" %}</th>
        <th>{% trans "Vehicle" %}</th>
        <th>{% trans "Created" %}</th>
        <th>{% trans "Comment" %}</th>
        <th>{% trans "Link" %}</th>
        <th>{% trans "Time" %}</th>
        {% if request.user.pk == object.pk %}
          <th></th>
        {% endif %}
        </thead>
        <tbody>
        {% for l in object.laptime_set.all %}
          <tr>
            <td><a href="{% url "track_detail" l.track.pk %}">{{ l.track }}</a></td>
            <td><a href="{% url "vehicle_detail" l.vehicle.pk %}">{{ l.vehicle }}</a></td>
            <td>{{ l.created }}</td>
            <td>{{ l.comment }}</td>
            <td>{% if l.link %}
              <a href="{{ l.link }}" target="_blank"><span class="glyphicon glyphicon-link"></span></a>
            {% endif %}</td>
            <td>{{ l.duration }}</td>
            {% if request.user.pk == object.pk %}
              <td><a class="small" href="#" onclick="confirm('{{ l.pk }}');">
                <span class="glyphicon glyphicon-trash"></span>
              </a></td>
            {% endif %}

          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
{% endblock %}

{% block trax_extra_script %}
  <script>
    var laptime_to_delete;
    function confirm(link) {
      laptime_to_delete = link;
      BootstrapDialog.confirm({
        title: 'Warning',
        message: 'Delete this lap time entry? You can not undo this action.',
        type: BootstrapDialog.TYPE_WARNING,
        closable: true,
        draggable: true,
        btnCancelLabel: "No, don't delete it!",
        btnOKLabel: "Yes, delete the entry!",
        btnOKClass: 'btn-warning',
        callback: function (result) {
          // result will be true if button was click, while it will be false if users close the dialog directly.
          if (result) {
            $.ajax({
              url: "/t/l/" + laptime_to_delete + "/delete/",
              success: function(data) {
                location.reload();
              }
            });
          }
        }
      });
    }

  </script>
{% endblock %}
