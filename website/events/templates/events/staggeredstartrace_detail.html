{% extends "base.html" %}
{% load i18n %}
{% load bootstrap3 %}
{% load widget_tweaks %}

{% block title %}{{ object.track }} ({{ object.laps }} laps) by {{ object.host }}{% endblock %}
{% block content %}

  <h1>{{ object.track }} ({{ object.laps }} laps) by {{ object.host }}
    (class: {{ object.vehicle_class }})</h1>
  <div class="hidden" id="event_status">{{ object.status }}</div>

  {% if object.status == 'i' %}
    <div class="row" id="showform" >
      <div class="col-md-4">
        {% if request.user.username == object.host.username %}
          {% include "events/host_detail_snippet.html" %}
        {% else %}
          {% include "events/participant_detail_snippet.html" %}
        {% endif %}
      </div>
      <div class="col-md-8" id="playerlist">
        {% include "events/enlist_form.html" %}
        <h2>Current players</h2>
        <table id="participantstable" class="table table-striped table-bordered">
          <thead>
          <tr>
            <th>Name</th>
            <th>Vehicle</th>
          </tr>
          </thead>
          <tbody>
          </tbody>

        </table>
      </div>
    </div>
  {% endif %}

  {% if object.status == 'r' %}
    <audio id="gogogo"></audio>
    <table class="table">
      <thead>
      <th>&nbsp;</th>
      <th>Name</th>
      <th>Vehicle</th>
      <tbody>
      {% for p in object.ssrparticipation_set.all %}
        <tr>
          <td id="line{{ p.pk }}">&nbsp;</td>
          <td>{{ p.player }} {{ p.start_in_millis }}</td>
          <td>{{ p.vehicle }}</td>
        </tr>
      {% endfor %}
      </tbody>
      <tfoot><tr><td></td><td></td><td></td></tr></tfoot>
      </thead>
    </table>


  {% endif %}

{% endblock %}

{% block trax_extra_script %}
  <script src="/static/staggeredstart.js"></script>
  {% if object.status == 'r' %}
    <script>
        $(document).ready(function() {
            {% for p in object.ssrparticipation_set.all %}
                {% if p.player.pk == request.user.pk %}
                    setTimeout( function() {usergreenlight( {{ p.pk }} ); }, {{ p.start_in_millis }} );
                {% else %}
                    setTimeout( function() { greenlight( {{ p.pk }} ); }, {{ p.start_in_millis }} );
                {% endif %}

            {% endfor %}
        });
    </script>
  {% endif %}
{% endblock %}
